# Research: 多平台接入调研

**Feature**: 002-platform-integration-research  
**Date**: 2025-01-05

## Research Questions

### 1. 微信公众号 API 调研

**Decision**: 使用微信公众平台开放接口（需要验证最新版本和功能）

**Rationale**: 
- 微信公众号是中国最主流的社交媒体平台之一
- 微信公众平台提供官方API接口
- 需要区分订阅号、服务号、企业号的不同权限

**需要调研的关键信息**:
- **官方文档地址**: https://developers.weixin.qq.com/doc/ (需要验证最新版本)
- **认证方式**: OAuth 2.0 授权码模式
- **API类型**: 
  - 素材管理API（上传图片、视频）
  - 消息管理API（群发消息）
  - 用户管理API（获取用户信息）
  - 数据统计API（获取统计数据）
- **限制条件**: 
  - 需要认证的服务号才能使用高级接口
  - 订阅号功能受限
  - API调用频率限制（需要确认具体数值）
- **开发者要求**: 
  - 需要注册微信公众平台账号
  - 需要完成开发者认证
  - 需要配置服务器URL和Token

**Alternatives considered**:
- 第三方SDK：可能存在稳定性风险，优先使用官方API
- Webhook方式：微信支持，但需要服务器配置

**⚠️ 需要实际验证**:
- 当前API版本和文档地址
- 具体的API调用频率限制
- 内容发布接口的具体参数和限制
- Token刷新机制

---

### 2. 微博开放平台 API 调研

**Decision**: 使用微博开放平台API（需要验证最新版本）

**Rationale**:
- 微博是中国重要的社交媒体平台
- 微博开放平台提供完整的API接口
- 支持OAuth 2.0认证

**需要调研的关键信息**:
- **官方文档地址**: https://open.weibo.com/wiki/ (需要验证最新版本)
- **认证方式**: OAuth 2.0 授权码模式
- **API类型**:
  - 微博发布API（发布文字、图片、视频）
  - 用户信息API（获取用户信息、粉丝列表）
  - 数据统计API（获取微博数据、互动数据）
  - 评论管理API（获取评论、回复评论）
- **限制条件**:
  - API调用频率限制（需要确认具体数值）
  - 内容长度限制（2000字）
  - 图片数量限制（9张）
  - 需要完成开发者认证
- **开发者要求**:
  - 需要注册微博开放平台账号
  - 需要创建应用并获取App Key和App Secret
  - 需要完成开发者认证（可能需要企业认证）

**Alternatives considered**:
- 第三方SDK：微博官方推荐使用官方SDK，但API调用仍需通过开放平台

**⚠️ 需要实际验证**:
- 当前API版本和文档地址
- 具体的API调用频率限制
- 视频发布接口的可用性和限制
- Token刷新机制和过期时间

---

### 3. X（推特）开放平台 API 调研

**Decision**: 使用 X API v2（需要验证最新版本和付费模式）

**Rationale**:
- X（原推特）是全球重要的社交媒体平台
- X 开放平台提供官方 API v2 接口
- 支持个人开发者，但有付费层级限制
- 需要注意免费层级的限制较严格

**需要调研的关键信息**:
- **官方文档地址**: https://developer.x.com/ (需要验证最新版本)
- **认证方式**: 
  - OAuth 2.0 Bearer Token (App-Only) - 适用于只读操作
  - OAuth 1.0a User Context - 适用于写操作和用户相关操作
- **API类型**:
  - 推文发布API（POST /2/tweets - 发布文字、图片、视频）
  - 媒体上传API（POST /1.1/media/upload - 上传图片、视频、GIF）
  - 用户信息API（获取用户信息、粉丝数据）
  - 数据统计API（获取推文数据、互动数据）
  - 评论管理API（获取评论、回复评论）
- **限制条件**:
  - **访问层级和定价**（2025年1月信息）:
    - Free 层：免费，500 posts/月（用户级），100 reads/月（应用级），仅1个应用ID
    - Basic 层：$200/月，3000 posts/月（用户级），50000 posts/月（应用级），15000 reads/月，2个应用ID
    - Pro 层：$5000/月，288000 posts/月（用户级），300000 posts/月（应用级），1000000 reads/月，3个应用ID
    - Enterprise 层：定制价格，专享服务
  - **推文内容限制**:
    - 字符限制：280字符（中文字符、日文、韩文字符按2个字符计算，最多140个CJK字符）
    - URL自动缩短为23个字符（通过t.co服务）
    - 媒体附件不占用字符数
  - **媒体上传限制**:
    - 图片：JPG/PNG/GIF/WEBP，最大5MB
    - GIF动画：最大15MB，最高1280x1080，最多350帧
    - 视频：MP4格式，最大512MB，时长0.5-140秒，最高60fps，H.264编码
    - 超过140秒的视频暂不支持（ProMediaAPI已废弃）
  - **API调用频率限制**:
    - 用户级别：200 POST请求/15分钟，300 POST请求/3小时，50 DELETE请求/15分钟
    - 应用级别：300 POST请求/3小时，1000 Likes/24小时，1000 Follows/24小时，15000 DM/24小时
- **开发者要求**:
  - 需要注册 X 开发者平台账号
  - 需要创建应用并获取 API Key 和 API Secret Key
  - 支持个人开发者（免费层可用，但功能受限）
  - 需要选择合适的访问层级（根据使用需求）

**Alternatives considered**:
- 第三方SDK：可能存在稳定性风险，优先使用官方API
- API v1.1（已废弃）：X 已迁移到 API v2，v1.1 媒体上传接口已废弃

**⚠️ 需要实际验证**:
- 当前API版本和文档地址（确认API v2的最新状态）
- Free 层级是否足够满足初期测试需求
- 付费层级的实际成本和功能差异
- OAuth 1.0a 和 OAuth 2.0 的实际使用场景选择
- 视频上传的分块上传流程（INIT/APPEND/FINALIZE）
- Token刷新机制和过期时间
- 内容审核机制和违规处理

**重要注意事项**:
- X API 采用付费模式，Free 层功能非常有限（仅500 posts/月）
- 中文字符按2个字符计算，需要特别注意字符计数
- 视频时长限制为140秒，超过的视频暂无法通过API上传
- 需要根据实际使用量选择合适的付费层级

---

### 4. 抖音开放平台 API 调研

**Decision**: 使用抖音开放平台API（需要验证最新版本和功能范围）

**Rationale**:
- 抖音是重要的短视频平台
- 抖音开放平台提供API接口
- 需要区分个人账号和企业账号的权限差异

**需要调研的关键信息**:
- **官方文档地址**: https://open.douyin.com/ (需要验证最新版本)
- **认证方式**: OAuth 2.0 授权码模式
- **API类型**:
  - 视频发布API（上传视频、发布视频）
  - 用户信息API（获取用户信息、粉丝数据）
  - 数据统计API（获取视频数据、互动数据）
  - 评论管理API（获取评论、回复评论）
- **限制条件**:
  - API调用频率限制（需要确认具体数值）
  - 视频格式和大小限制
  - 内容审核要求
  - 需要完成开发者认证（可能需要企业认证）
- **开发者要求**:
  - 需要注册抖音开放平台账号
  - 需要创建应用并获取Client Key和Client Secret
  - 需要完成开发者认证（个人/企业）

**Alternatives considered**:
- 抖音创作者平台：主要面向个人创作者，API功能可能受限
- 第三方工具：可能存在合规风险

**⚠️ 需要实际验证**:
- 当前API版本和文档地址
- 视频发布API的具体参数和限制
- 个人账号和企业账号的API权限差异
- 内容审核机制和违规处理

---

### 5. 小红书开放平台 API 调研

**Decision**: 使用小红书开放平台API（需要验证最新版本和功能范围）

**Rationale**:
- 小红书是重要的内容社区平台
- 小红书开放平台提供API接口
- 需要了解API的功能范围和限制

**需要调研的关键信息**:
- **官方文档地址**: https://open.xiaohongshu.com/ (需要验证最新版本)
- **认证方式**: OAuth 2.0 授权码模式（需要确认）
- **API类型**:
  - 笔记发布API（发布图文、视频笔记）
  - 用户信息API（获取用户信息、粉丝数据）
  - 数据统计API（获取笔记数据、互动数据）
  - 评论管理API（获取评论、回复评论）
- **限制条件**:
  - API调用频率限制（需要确认具体数值）
  - 内容长度限制（1000字）
  - 图片数量限制（9张）
  - 需要完成开发者认证（可能需要企业认证）
- **开发者要求**:
  - 需要注册小红书开放平台账号
  - 需要创建应用并获取App ID和App Secret
  - 需要完成开发者认证（个人/企业）

**Alternatives considered**:
- 小红书创作者平台：主要面向个人创作者，API功能可能受限

**⚠️ 需要实际验证**:
- 当前API版本和文档地址
- API的实际可用性和功能范围
- 视频笔记发布接口的可用性
- 开发者认证的具体要求

---

### 5. 统一接口设计策略

**Decision**: 采用适配器模式（Adapter Pattern）设计统一接口

**Rationale**:
- 各平台API存在差异（参数格式、响应格式、错误处理）
- 需要为前端提供统一的接口
- 适配器模式可以屏蔽平台差异，便于维护和扩展

**设计思路**:
1. **统一接口层**: 定义统一的接口规范（发布内容、获取数据等）
2. **平台适配器**: 为每个平台实现适配器，将统一接口转换为平台特定API调用
3. **错误处理**: 统一错误码和错误信息格式
4. **认证管理**: 统一的OAuth流程处理，但保留平台特定的认证逻辑

**Alternatives considered**:
- **直接调用平台API**: 前端需要处理各平台差异，复杂度高
- **GraphQL统一层**: 过度设计，当前场景不需要
- **适配器模式**: 平衡了统一性和灵活性，适合多平台场景

---

### 6. OAuth 2.0 统一流程设计

**Decision**: 实现统一的OAuth 2.0授权流程处理

**Rationale**:
- 所有平台都使用OAuth 2.0认证
- 流程相似但细节有差异（参数名、回调URL格式等）
- 需要统一处理以简化前端逻辑

**统一流程设计**:
1. **授权请求**: 统一生成授权URL（处理平台差异）
2. **回调处理**: 统一处理授权回调（验证state、换取token）
3. **Token管理**: 统一存储和管理token（加密存储、自动刷新）
4. **状态同步**: 统一检查token有效性

**平台差异处理**:
- 参数名差异：在适配器中处理
- 回调URL格式：统一为 `/api/auth/callback/{platform}`
- Token刷新机制：各平台不同，在适配器中实现

---

### 7. 错误处理和重试策略

**Decision**: 分层错误处理和智能重试机制

**Rationale**:
- 各平台API错误码和错误信息格式不同
- 需要统一的错误处理以提升用户体验
- 网络错误和临时故障需要重试

**错误分类**:
1. **认证错误**: Token过期、无效 → 提示重新授权
2. **内容错误**: 内容违规、格式错误 → 返回具体错误信息
3. **频率限制**: API调用超限 → 延迟重试
4. **网络错误**: 超时、连接失败 → 自动重试（最多3次）
5. **平台错误**: 平台服务异常 → 记录日志，提示稍后重试

**重试策略**:
- 网络错误：立即重试（最多3次，间隔递增：1s, 3s, 5s）
- 频率限制：延迟重试（根据返回的retry-after头）
- 认证错误：不重试，直接提示重新授权

---

## Technical Decisions Summary

1. **调研方式**: 查阅各平台官方文档，整理调研报告
2. **文档结构**: 按平台分类，包含API能力、认证方式、限制条件、开发者要求
3. **对比分析**: 多维度对比（认证、发布、数据、限制、要求）
4. **技术方案**: 适配器模式 + 统一OAuth流程 + 分层错误处理
5. **实施优先级**: 先调研，再对比，最后制定技术方案

## Dependencies

- 各平台官方文档（需要实际访问验证）
- 可能需要注册开发者账号进行API测试（可选）
- 现有项目架构（Next.js App Router、Prisma、Redis）

## Implementation Notes

- **AI内容生成功能**: 暂不包含在此次调研中，后续迭代
- **文档维护**: 平台API可能更新，需要定期维护文档
- **实际验证**: 调研结果需要尽可能基于实际API测试验证
- **风险评估**: 需要识别各平台API的限制和风险，制定应对方案

## 下一步行动

1. **访问各平台官方文档**: 验证文档地址和最新版本
2. **整理详细调研报告**: 为每个平台创建详细的调研文档
3. **进行对比分析**: 创建多维度对比表格
4. **制定技术方案**: 基于调研结果设计统一集成架构
5. **验证可行性**: 如可能，进行小规模API测试验证
